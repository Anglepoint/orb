/*! orb v0.1.0, Javascript pivot grid library.
 *  (c) Najmeddine Nouri, 2014-12-19.
 *  Licence: MIT.
 */

"use strict";!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.orb=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b,c,e){var f=0,g=0,h=("all"===b?c:b).length;return h>0&&(e||h>1?(d(a,b,c,function(a){g+=a}),g/=h,d(a,b,c,function(a){f+=(a-g)*(a-g)}),f/=e?h:h-1):f=0/0),f}function d(a,b,c,d){var e="all"===b;if(b=e?c:b,b.length>0)for(var f=0;f<b.length;f++)d((e?b[f]:c[b[f]])[a])}b.exports={count:function(a,b,c){return"all"===b?c.length:b.length},sum:function(a,b,c){var e=0;return d(a,b,c,function(a){e+=a}),e},min:function(a,b,c){var e=null;return d(a,b,c,function(a){(null==e||e>a)&&(e=a)}),e},max:function(a,b,c){var e=null;return d(a,b,c,function(a){(null==e||a>e)&&(e=a)}),e},avg:function(a,b,c){var e=0,f=("all"===b?c:b).length;return f>0&&(d(a,b,c,function(a){e+=a}),e/=f),e},prod:function(a,b,c){var e,f=("all"===b?c:b).length;return f>0&&(e=1,d(a,b,c,function(a){e*=a})),e},stdev:function(a,b,d){return Math.sqrt(c(a,b,d,!1))},stdevp:function(a,b,d){return Math.sqrt(c(a,b,d,!0))},"var":function(a,b,d){return c(a,b,d,!1)},varp:function(a,b,d){return c(a,b,d,!0)}}},{}],2:[function(a,b){var c=a("./orb.utils"),d=a("./orb.dimension"),e={COLUMNS:1,ROWS:2,DATA:3};b.exports=function(a,b){function f(a){for(var b=0;b<h.fields.length;b++)if(h.fields[b].name===a.name)return b;return-1}function g(){if(null!=h.pgrid.config.dataSource&&h.dimensionsCount>0){var a=h.pgrid.config.dataSource;if(null!=a&&c.isArray(a)&&a.length>0)for(var b=0,e=a.length;e>b;b++)for(var f=a[b],g=h.root,j=0;j<h.dimensionsCount;j++){var k=h.dimensionsCount-j,l=h.fields[j],m=f[l.name],n=g.subdimvals;void 0!==n[m]?g=n[m]:(g.values.push(m),g=new d(++i,g,m,l,k,!1,j==h.dimensionsCount-1),n[m]=g,g.rowIndexes=[],h.dimensionsByDepth[k].push(g)),g.rowIndexes.push(b)}}}var h=this,i=0;null!=a&&null!=a.config&&(this.pgrid=a,this.type=b,this.fields=function(){switch(b){case e.COLUMNS:return h.pgrid.config.columnFields;case e.ROWS:return h.pgrid.config.rowFields;case e.DATA:return h.pgrid.config.dataFields;default:return[]}}(),this.dimensionsCount=null,this.root=null,this.dimensionsByDepth=null,this.update=function(){h.dimensionsCount=h.fields.length,h.root=new d(++i,null,null,null,h.dimensionsCount+1,!0),h.dimensionsByDepth={};for(var a=1;a<=h.dimensionsCount;a++)h.dimensionsByDepth[a]=[];g();for(var b=0;b<h.fields.length;b++){var c=h.fields[b];("asc"===c.sort.order||"desc"===c.sort.order)&&h.sort(c,!0)}},this.sort=function(a,b){if(null!=a){b!==!0&&(a.sort.order="asc"!==a.sort.order?"asc":"desc");for(var c=h.dimensionsCount-f(a),d=c===h.dimensionsCount?[h.root]:h.dimensionsByDepth[c+1],e=0;e<d.length;e++)d[e].values.sort(),"desc"===a.sort.order&&d[e].values.reverse()}},this.update())},b.exports.Type=e},{"./orb.dimension":4,"./orb.utils":11}],3:[function(a,b){function c(a,b,c){for(var d=0;d<b.length;d++)if(null!=b[d][a])return b[d][a];return c}function d(){for(var a=[],b=[],d=[],e=[],f=[],g=0;g<arguments.length;g++){var h=arguments[g]||{};a.push(h),b.push(h.sort||{}),d.push(h.subTotal||{}),e.push(h.filter||{}),f.push({aggregateFunc:0===g?h.aggregateFunc:h.aggregateFunc?h.aggregateFunc():null,formatFunc:0===g?h.formatFunc:h.formatFunc?h.formatFunc():null})}return new l({name:c("name",a,""),caption:c("caption",a,""),filter:{type:c("type",e,"operator"),regexp:c("regexp",e,null),operator:c("operator",e,null),value:c("value",e,null)},sort:{order:c("order",b,null),customfunc:c("customfunc",b,null)},subTotal:{visible:c("visible",d,!0),collapsible:c("collapsible",d,!0),collapsed:c("collapsed",d,!1)},aggregateFunc:c("aggregateFunc",f,null),formatFunc:c("formatFunc",f,null)},!1)}function e(a,b,c,e){var f;if(e)switch(b){case j.Type.ROWS:f=e.rowSettings;break;case j.Type.COLUMNS:f=e.columnSettings;break;case j.Type.DATA:f=e.dataSettings;break;default:f=null}else f=null;return d(c,f,e,a)}function f(a){a=a||{},this.rowsvisible=void 0!==a.rowsvisible?a.rowsvisible:!0,this.columnsvisible=void 0!==a.columnsvisible?a.columnsvisible:!0}function g(a,b){var c={visible:b===!0?!0:void 0,collapsible:b===!0?!0:void 0,collapsed:b===!0?!1:void 0};a=a||{},this.visible=void 0!==a.visible?a.visible:c.visible,this.collapsible=void 0!==a.collapsible?a.collapsible:c.collapsible,this.collapsed=void 0!==a.collapsed?a.collapsed:c.collapsed}function h(a){a=a||{},this.order=a.order,this.customfunc=a.customfunc}function i(a){a=a||{},this.type=a.type,this.regexp=a.regexp,this.operator=a.operator,this.value=a.value}var j=a("./orb.axe"),k=a("./orb.aggregation"),l=b.exports.field=function(a,b){function c(a){return a?a.toString():""}a=a||{},this.name=a.name,this.caption=a.caption||this.name,this.filter=new i(a.filter),this.sort=new h(a.sort),this.subTotal=new g(a.subTotal);var d,e;this.aggregateFunc=function(a){return a?void(d="string"==typeof a&&k[a]?k[a]:"function"==typeof a?a:k.sum):d},this.formatFunc=function(a){return a?void(e=a):e},this.aggregateFunc(a.aggregateFunc||"sum"),this.formatFunc(a.formatFunc||c),b!==!1&&((this.rowSettings=new l(a.rowSettings,!1)).name=this.name,(this.columnSettings=new l(a.columnSettings,!1)).name=this.name,(this.dataSettings=new l(a.dataSettings,!1)).name=this.name)};b.exports.config=function(a){function b(a,b){var d=c(a,b);return d>-1?a[d]:null}function c(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return-1}var d=this;this.dataSource=a.dataSource,this.dataHeadersLocation="columns"===a.dataHeadersLocation?"columns":"rows",this.grandTotal=new f(a.grandTotal),this.subTotal=new g(a.subTotal,!0),this.allFields=(a.fields||[]).map(function(a){return new l(a)}),this.rowFields=(a.rows||[]).map(function(a){return e(d,j.Type.ROWS,a,b(d.allFields,a.name))}),this.columnFields=(a.columns||[]).map(function(a){return e(d,j.Type.COLUMNS,a,b(d.allFields,a.name))}),this.dataFields=(a.data||[]).map(function(a){return e(d,j.Type.DATA,a,b(d.allFields,a.name))}),this.dataFieldsCount=this.dataFields?this.dataFields.length||1:1,d.availablefields=function(){return d.allFields.filter(function(a){var b=function(b){return a.name!==b.name};return d.dataFields.every(b)&&d.rowFields.every(b)&&d.columnFields.every(b)})},this.moveField=function(a,f,g,h){var i,k,l,m=b(d.allFields,a);if(m){switch(f){case j.Type.ROWS:i=d.rowFields;break;case j.Type.COLUMNS:i=d.columnFields;break;case j.Type.DATA:i=d.dataFields}switch(g){case j.Type.ROWS:l=d.rowFields;break;case j.Type.COLUMNS:l=d.columnFields;break;case j.Type.DATA:l=d.dataFields}if(i||l){if(i){if(k=c(i,a),f===g&&(k==i.length-1&&null==h||k===h-1))return!1;i.splice(k,1)}return m=e(d,g,null,m),l&&(null!=h?l.splice(h,0,m):l.push(m)),d.dataFieldsCount=d.dataFields?d.dataFields.length||1:1,!0}}}}},{"./orb.aggregation":1,"./orb.axe":2}],4:[function(a,b){b.exports=function(a,b,c,d,e,f,g){var h=this;this.id=a,this.parent=b,this.value=c,this.isRoot=f,this.isLeaf=g,this.field=d,this.depth=e,this.values=[],this.subdimvals={},this.rowIndexes=null,this.getRowIndexes=function(a){if(null==h.rowIndexes){this.rowIndexes=[];for(var b=0;b<h.values.length;b++)h.subdimvals[h.values[b]].getRowIndexes(this.rowIndexes)}if(null!=a){for(var c=0;c<h.rowIndexes.length;c++)a.push(h.rowIndexes[c]);return a}return h.rowIndexes}}},{}],5:[function(a,b){b.exports.utils=a("./orb.utils"),b.exports.pgrid=a("./orb.pgrid"),b.exports.pgridwidget=a("./orb.ui.pgridwidget")},{"./orb.pgrid":6,"./orb.ui.pgridwidget":9,"./orb.utils":11}],6:[function(a,b){var c=a("./orb.axe"),d=a("./orb.config").config;b.exports=function(a){function b(a,b,c){var d={};if(i.config.dataFieldsCount>0){var e;if(null==a)e=b;else if(null==b)e=a;else{e=[];for(var f=0;f<a.length;f++){var g=a[f];if(g>=0){var j=b.indexOf(g);j>=0&&(a[f]=0-(g+2),e.push(g))}}}for(var k=i.config.dataSource,l=0;l<i.config.dataFieldsCount;l++){var m=i.config.dataFields[l]||h;m.aggregateFunc&&(d[m.name]=m.aggregateFunc()(m.name,e||"all",k,c,b))}}return d}function e(a){if(a){var c={},d="r"+a.id;if(void 0===g[d]&&(g[d]=a.isRoot?null:g[a.parent.id]||a.getRowIndexes()),c[i.columns.root.id]=b(a.isRoot?null:g[d].slice(0),null),i.columns.dimensionsCount>0)for(var e=0,f=[i.columns.root];e<f.length;){for(var h=f[e],j=a.isRoot?null:h.isRoot?g[d].slice(0):g["c"+h.id].slice(0),k=0;k<h.values.length;k++){var l=h.subdimvals[h.values[k]],m="c"+l.id;if(void 0===g[m]&&(g[m]=g[m]||l.getRowIndexes().slice(0)),c[l.id]=b(j,g[m],a.isRoot?null:a.getRowIndexes()),!l.isLeaf&&(f.push(l),j)){g[m]=[];for(var n=0;n<j.length;n++){var o=j[n];-1!=o&&0>o&&(g[m].push(0-(o+2)),j[n]=-1)}}}g["c"+h.id]=void 0,e++}return c}}function f(){if(i.dataMatrix={},g={},i.dataMatrix[i.rows.root.id]=e(i.rows.root),i.rows.dimensionsCount>0)for(var a,b=[i.rows.root],c=0;c<b.length;){a=b[c];for(var d=0;d<a.values.length;d++){var f=a.subdimvals[a.values[d]];i.dataMatrix[f.id]=e(f),f.isLeaf||b.push(f)}c++}}var g,h={name:"#undefined#"},i=this;this.config=new d(a),this.rows=new c(i,c.Type.ROWS),this.columns=new c(i,c.Type.COLUMNS),this.dataMatrix={},this.moveField=function(a,b,c,d){i.config.moveField(a,b,c,d)&&(i.rows.update(),i.columns.update(),f())},this.getData=function(a,b,c){return b&&c?(a=a||(i.config.dataFields[0]||h).name,i.dataMatrix[b.id]&&i.dataMatrix[b.id][c.id]?i.dataMatrix[b.id][c.id][a]||null:null):void 0},f()}},{"./orb.axe":2,"./orb.config":3}],7:[function(a,b){var c=a("./orb.axe"),d=a("./orb.ui.header");b.exports=function(a){function b(){function a(a){a&&a.dim.field.subTotal.visible&&b.push(a.subtotalHeader)}var b=[];if(f.uiInfos.length>0){for(var c,e=f.uiInfos[f.uiInfos.length-1],i=e[0],j=i.parent,k=0;k<e.length;k++){if(i=e[k],c=i.parent,c!=j){if(a(j),null!=c)for(var l=c.parent,m=j?j.parent:null;l!=m&&null!=m;)a(m),l=l?l.parent:null,m=m?m.parent:null;j=c}if(b.push(e[k]),k===e.length-1)for(;null!=j;)a(j),j=j.parent}f.axe.pgrid.config.grandTotal.columnsvisible&&f.axe.dimensionsCount>1&&b.push(f.uiInfos[0][f.uiInfos[0].length-1])}if(g){f.leafsHeaders=[];for(var n=0;n<b.length;n++)for(var o=0;h>o;o++)f.leafsHeaders.push(new d.dataHeader(f.axe.pgrid.config.dataFields[o],b[n]));f.uiInfos.push(f.leafsHeaders)}else f.leafsHeaders=b}function e(a,b){for(var e=b[b.length-1],g=f.axe.root.depth===a?[null]:b[f.axe.root.depth-a-1].filter(function(a){return a.type!==d.HeaderType.SUB_TOTAL}),i=0;i<g.length;i++)for(var j=g[i],k=null==j?f.axe.root:j.dim,l=0;l<k.values.length;l++){var m,n=k.values[l],o=k.subdimvals[n];m=!o.isLeaf&&o.field.subTotal.visible?new d.header(c.Type.COLUMNS,d.HeaderType.SUB_TOTAL,o,j,h):null;var p=new d.header(c.Type.COLUMNS,null,o,j,h,m);e.push(p),!o.isLeaf&&o.field.subTotal.visible&&e.push(m)}}var f=this;this.axe=a,this.uiInfos=null,this.leafsHeaders=null;var g,h;this.build=function(){if(h="columns"===f.axe.pgrid.config.dataHeadersLocation?f.axe.pgrid.config.dataFieldsCount:1,g="columns"===f.axe.pgrid.config.dataHeadersLocation&&h>1,f.uiInfos=[],null!=f.axe){for(var a=f.axe.root.depth;a>1;a--)f.uiInfos.push([]),e(a,f.uiInfos);f.axe.pgrid.config.grandTotal.columnsvisible&&(f.uiInfos[0]=f.uiInfos[0]||[]).push(new d.header(c.Type.COLUMNS,d.HeaderType.GRAND_TOTAL,f.axe.root,null,h)),0===f.uiInfos.length&&f.uiInfos.push([new d.header(c.Type.COLUMNS,d.HeaderType.INNER,f.axe.root,null,h)]),b()}},this.build()}},{"./orb.axe":2,"./orb.ui.header":8}],8:[function(a,b){function c(a){this.axetype=a.axetype,this.type=a.type,this.template=a.template,this.value=a.value,this.expanded=!0,this.cssclass=a.cssclass,this.hspan=a.hspan||function(){return 1},this.vspan=a.vspan||function(){return 1},this.visible=a.isvisible||function(){return!0}}var d=a("./orb.axe"),e=b.exports.HeaderType={EMPTY:1,DATA_HEADER:2,DATA_VALUE:3,FIELD_BUTTON:4,INNER:5,WRAPPER:6,SUB_TOTAL:7,GRAND_TOTAL:8,getHeaderClass:function(a,b){var c="";switch(a){case e.EMPTY:case e.FIELD_BUTTON:c="empty";break;case e.INNER:c="header";break;case e.WRAPPER:b===d.Type.ROWS?c="header":b===d.Type.COLUMNS&&(c="header");break;case e.SUB_TOTAL:c="header header-sub-total";break;case e.GRAND_TOTAL:c="header header-grand-total"}return c},getCellClass:function(a,b){var c="";switch(a){case e.GRAND_TOTAL:c="cell-grand-total";break;case e.SUB_TOTAL:c=b===e.GRAND_TOTAL?"cell-grand-total":"cell-sub-total";break;default:c=b===e.GRAND_TOTAL?"cell-grand-total":b===e.SUB_TOTAL?"cell-sub-total":"cell"}return c}};b.exports.header=function(a,b,f,g,h,i){function j(){if(o.type===e.SUB_TOTAL){for(var a=o.parent;null!=a;){if(a.subtotalHeader&&!a.subtotalHeader.expanded)return!1;a=a.parent}return!0}var b=o.dim.isRoot||o.dim.isLeaf||!o.dim.field.subTotal.visible||o.subtotalHeader.expanded;if(!b)return!1;for(var c=o.parent;null!=c&&(!c.dim.field.subTotal.visible||null!=c.subtotalHeader&&c.subtotalHeader.expanded);)c=c.parent;return null==c||null==c.subtotalHeader?b:c.subtotalHeader.expanded}function k(){var a,b=0,c=!1;if(o.visible()){if(o.dim.isLeaf)return h;for(var d=0;d<o.subheaders.length;d++){var f=o.subheaders[d];f.dim.isLeaf?b+=h:(a=p?f.vspan():f.hspan(),b+=a,0===d&&(0===a||p&&f.type===e.SUB_TOTAL&&!f.expanded)&&(c=!0))}return b+(c?1:0)}return b}var l,m,n,o=this,p=a===d.Type.ROWS;switch(b=b||(1===f.depth?e.INNER:e.WRAPPER)){case e.GRAND_TOTAL:n="Grand Total",l=p?f.depth-1||1:h,m=p?h:f.depth-1||1;break;case e.SUB_TOTAL:n="Total "+f.value,l=p?f.depth:h,m=p?h:f.depth;break;default:n=f.value,l=p?1:null,m=p?null:1}c.call(this,{axetype:a,type:b,template:p?"cell-template-row-header":"cell-template-column-header",value:n,cssclass:e.getHeaderClass(b,a),hspan:null!=l?function(){return l}:k,vspan:null!=m?function(){return m}:k,isvisible:j}),this.subtotalHeader=i,this.parent=g,this.subheaders=[],this.dim=f,this.expanded=b!==e.SUB_TOTAL||!f.field.subTotal.collapsed,this.expand=function(){o.expanded=!0},this.collapse=function(){o.expanded=!1},null!=g&&g.subheaders.push(this)},b.exports.dataHeader=function(a,b){c.call(this,{axetype:null,type:e.DATA_HEADER,template:"cell-template-dataheader",value:a,cssclass:e.getHeaderClass(b.type),isvisible:b.visible}),this.parent=b},b.exports.dataCell=function(a,b,d,f){var g=d.type===e.DATA_HEADER?d.parent.dim:d.dim,h=f.type===e.DATA_HEADER?f.parent.dim:f.dim,i=d.type===e.DATA_HEADER?d.parent.type:d.type,j=f.type===e.DATA_HEADER?f.parent.type:f.type,k=a.config.dataFieldsCount>1?"rows"===a.config.dataHeadersLocation?d.value:f.value:a.config.dataFields[0];c.call(this,{axetype:null,type:e.DATA_VALUE,template:"cell-template-datavalue",value:a.getData(k?k.name:null,g,h),cssclass:"cell "+e.getCellClass(i,j),isvisible:b}),this.datafield=k},b.exports.buttonCell=function(a){c.call(this,{axetype:null,type:e.FIELD_BUTTON,template:"cell-template-fieldbutton",value:a,cssclass:e.getHeaderClass(e.FIELD_BUTTON)})},b.exports.emptyCell=function(a,b){c.call(this,{axetype:null,type:e.EMPTY,template:"cell-template-empty",value:null,cssclass:e.getHeaderClass(e.EMPTY),hspan:function(){return a},vspan:function(){return b}})}},{"./orb.axe":2}],9:[function(a,b){var c=a("./orb.axe"),d=a("./orb.pgrid"),e=a("./orb.ui.header"),f=a("./orb.ui.rows"),g=a("./orb.ui.cols"),h=a("./react/orb.react.compiled");b.exports=function(a){function b(){function a(a,b){return a.length!==b?(a.length=b,!0):!1}function b(a,b){return function(){return a()&&b()}}i.rows=new f(i.pgrid.rows),i.columns=new g(i.pgrid.columns);var c=i.rows.uiInfos,d=c.length,h=i.columns.uiInfos,j=h.length,k=i.columns.leafsHeaders,l=k.length;i.rowHeadersWidth=(i.pgrid.rows.fields.length||1)+("rows"===i.pgrid.config.dataHeadersLocation&&i.pgrid.config.dataFieldsCount>1?1:0),i.columnHeadersWidth=l,i.rowHeadersHeight=d,i.columnHeadersHeight=(i.pgrid.columns.fields.length||1)+("columns"===i.pgrid.config.dataHeadersLocation&&i.pgrid.config.dataFieldsCount>1?1:0),i.totalWidth=i.rowHeadersWidth+i.columnHeadersWidth,i.totalHeight=i.rowHeadersHeight+i.columnHeadersHeight;var m=[];a(m,j+d);for(var n,o=0;j>o;o++){var p=h[o],q=0;if(n=m[o]=m[o]||[],j>1&&0===o)q=1,a(n,q+p.length),n[0]=new e.emptyCell(i.rowHeadersWidth,i.columnHeadersHeight-1);else if(o===j-1)if(q=i.rowHeadersWidth,a(n,q+p.length),i.pgrid.rows.fields.length>0)for(var r=0;r<i.pgrid.config.rowFields.length;r++)n[r]=new e.buttonCell(i.pgrid.config.rowFields[r]);else n[0]=new e.emptyCell(i.rowHeadersWidth,1);for(var s=0;s<p.length;s++)n[q+s]=p[s]}for(var t=0;d>t;t++){var u=c[t];n=m[j+t]=m[j+t]||new Array(u.length+l),a(n,u.length+l);for(var v=0;v<u.length;v++)n[v]=u[v];for(var w=u[u.length-1],x=0;l>x;x++){var y=k[x],z=b(w.visible,y.visible);n[u.length+x]=new e.dataCell(i.pgrid,z,w,y)}}i.cells=m}var i=this;this.pgrid=new d(a),this.rows=null,this.columns=null,this.rowHeadersWidth=null,this.columnHeadersWidth=null,this.rowHeadersHeight=null,this.columnHeadersHeight=null,this.totalWidth=null,this.totalWidth=null,this.sort=function(a,d){if(a===c.Type.ROWS)i.pgrid.rows.sort(d);else{if(a!==c.Type.COLUMNS)return;i.pgrid.columns.sort(d)}b()},this.moveField=function(a,c,d,e){i.pgrid.moveField(a,c,d,e),b()},this.filters=null,this.cells=[],this.render=function(b){var c=React.createFactory(h.PivotTable),d=c({data:i,config:a});React.render(d,b)},b()}},{"./orb.axe":2,"./orb.pgrid":6,"./orb.ui.cols":7,"./orb.ui.header":8,"./orb.ui.rows":10,"./react/orb.react.compiled":12}],10:[function(a,b){var c=a("./orb.axe"),d=a("./orb.ui.header");b.exports=function(a){function b(a,b){if(g)for(var c=a[a.length-1],e=0;h>e;e++)c.push(new d.dataHeader(f.axe.pgrid.config.dataFields[e],b)),h-1>e&&a.push(c=[])}function e(a,f){if(f.values.length>0)for(var g=a.length-1,i=a[g],j=i.length>0?i[i.length-1]:null,k=0;k<f.values.length;k++){var l,m=f.values[k],n=f.subdimvals[m];l=!n.isLeaf&&n.field.subTotal.visible?new d.header(c.Type.ROWS,d.HeaderType.SUB_TOTAL,n,j,h):null;var o=new d.header(c.Type.ROWS,null,n,j,h,l);k>0&&a.push(i=[]),i.push(o),n.isLeaf?b(a,o):(e(a,n),n.field.subTotal.visible&&(a.push([l]),b(a,l)))}}var f=this;this.axe=a,this.uiInfos=[];var g,h;this.build=function(){h="rows"===f.axe.pgrid.config.dataHeadersLocation?f.axe.pgrid.config.dataFieldsCount||1:1,g="rows"===f.axe.pgrid.config.dataHeadersLocation&&h>1;var a=[[]];if(null!=f.axe){if(e(a,f.axe.root),f.axe.pgrid.config.grandTotal.rowsvisible){var i=a[a.length-1],j=new d.header(c.Type.ROWS,d.HeaderType.GRAND_TOTAL,f.axe.root,null,h);0===i.length?i.push(j):a.push([j]),b(a,j)}0===a[0].length&&a[0].push(new d.header(c.Type.ROWS,d.HeaderType.INNER,f.axe.root,null,h))}f.uiInfos=a},this.build()}},{"./orb.axe":2,"./orb.ui.header":8}],11:[function(a,b){b.exports={ns:function(a,b){var c=a.split("."),d=0;for(b=b||window;d<c.length;)b[c[d]]=b[c[d]]||{},b=b[c[d]],d++;return b},ownProperties:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},findInArray:function(a,b){if(this.isArray(a)&&b)for(var c=0;c<a.length;c++){var d=a[c];if(b(d))return d}return void 0},jsonStringify:function(a,b){function c(a,c){return b&&b.indexOf(a)>-1?void 0:c}return JSON.stringify(a,c,2)}}},{}],12:[function(a,b){function c(a,b,c){var d;if(null!=a)for(var e=0,f=a.length;f>e&&(d=b(a[e],e),void 0===d||c!==!0);e++);return d}function d(a){if(null!=a){var b=a.getBoundingClientRect();return{x:b.left+0,y:b.top+0}}return{x:0,y:0}}function e(a){if(null!=a){var b=a.getBoundingClientRect();return{width:b.right-b.left,height:b.bottom-b.top}}return{x:0,y:0}}var f=a("../orb.utils"),g=a("../orb.axe"),h=a("../orb.ui.header"),i=1,j=b.exports;b.exports.PivotTable=React.createClass({displayName:"PivotTable",getInitialState:function(){return j.DragManager.init(this),{}},sort:function(a,b){this.props.data.sort(a,b),this.setProps(this.props)},moveButton:function(a,b,c){this.props.data.moveField(a.props.field.name,a.props.axetype,b,c),this.setProps(this.props)},expandRow:function(a){a.expanded=!0,this.setProps({})},collapseRow:function(a){a.subtotalHeader.expanded=!1,this.setProps({})},render:function(){var a=this,b=this.props.data,c=j.PivotButton,d=j.PivotRow,e=j.DropTarget,h=b.pgrid.config.availablefields().map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:null,position:d,rootComp:a})}),k=b.pgrid.config.dataFields.map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:g.Type.DATA,position:d,rootComp:a})}),l=b.pgrid.config.columnFields.map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:g.Type.COLUMNS,position:d,rootComp:a})}),m=f.findInArray(b.cells,function(a){return"cell-template-fieldbutton"===a[0].template});m=void 0!==m?m.filter(function(a){return"cell-template-fieldbutton"===a.template}).map(function(b,d){return React.createElement(c,{key:b.value.name,field:b.value,axetype:g.Type.ROWS,position:d,rootComp:a})}):[];var n=React.createElement("td",{className:"empty",colSpan:b.rowHeadersWidth+i,rowSpan:"1"},React.createElement(e,{data:m,axetype:g.Type.ROWS})),o=b.cells.map(function(c,e){return e==b.columnHeadersHeight-1?React.createElement(d,{key:e,row:c,rowButtonsCount:b.rowHeadersWidth,rowButtonsCell:n,rootComp:a}):React.createElement(d,{key:e,row:c,rootComp:a})}),p=this.props.config.width?{width:this.props.config.width}:{};return React.createElement("div",{className:"orb-container",style:p},React.createElement("table",{id:"tbl",className:"orb",style:{width:"100%"}},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"available-fields field-group",colSpan:i,rowSpan:"1"},React.createElement("div",{className:"field-group-caption"},"Fields:")),React.createElement("td",{className:"available-fields",colSpan:b.totalWidth,rowSpan:"1"},React.createElement(e,{data:h,axetype:null}))),React.createElement("tr",null,React.createElement("td",{className:"field-group",colSpan:i,rowSpan:"1"},React.createElement("div",{className:"field-group-caption"},"Data fields:")),React.createElement("td",{className:"empty",colSpan:b.totalWidth,rowSpan:"1"},React.createElement(e,{data:k,axetype:g.Type.DATA}))),React.createElement("tr",null,React.createElement("td",{className:"empty",colSpan:b.rowHeadersWidth+i,rowSpan:"1"}),React.createElement("td",{className:"empty",colSpan:b.columnHeadersWidth,rowSpan:"1"},React.createElement(e,{data:l,axetype:g.Type.COLUMNS}))),o)))}}),b.exports.PivotRow=React.createClass({displayName:"PivotRow",render:function(){var a,b=this,c=j.PivotCell,d=this.props.row.length-1,e=this.props.row[0],f={};return void 0!==this.props.rowButtonsCell?(a=this.props.row.slice(this.props.rowButtonsCount).map(function(a,e){var f=e===d-b.props.rowButtonsCount;return React.createElement(c,{key:e,cell:a,rightmost:f,leftmost:!1,rootComp:b.props.rootComp})}),React.createElement("tr",null,this.props.rowButtonsCell,a)):("cell-template-row-header"==e.template&&e.visible&&!e.visible()&&(f.display="none"),a=this.props.row.map(function(a,e){var f=e===d,g=0===e&&(a.type===h.HeaderType.EMPTY||a.type===h.HeaderType.SUB_TOTAL||a.type===h.HeaderType.GRAND_TOTAL||a.dim&&(a.dim.isRoot||a.dim.parent.isRoot));return React.createElement(c,{key:e,cell:a,rightmost:f,leftmost:g,rootComp:b.props.rootComp})}),React.createElement("tr",{style:f},a))}}),b.exports.PivotCell=React.createClass({displayName:"PivotCell",expand:function(){this.props.rootComp.expandRow(this.props.cell)},collapse:function(){this.props.rootComp.collapseRow(this.props.cell)},render:function(){var a,b=this.props.cell,c=[],d="\u25bc",e="\u25b6";switch(b.template){case"cell-template-row-header":case"cell-template-column-header":b.type===h.HeaderType.WRAPPER&&b.dim.field.subTotal.visible&&b.dim.field.subTotal.collapsible&&b.subtotalHeader.expanded?c.push(React.createElement("span",{key:"toggle-button",className:"toggle-button",onClick:this.collapse},d)):b.type!==h.HeaderType.SUB_TOTAL||b.expanded||c.push(React.createElement("span",{key:"toggle-button",className:"toggle-button",onClick:this.expand},e)),a=b.value;break;case"cell-template-dataheader":a=b.value.caption;break;case"cell-template-datavalue":a=b.datafield&&b.datafield.formatFunc?b.datafield.formatFunc()(b.value):b.value}c.push(React.createElement("span",{key:"cell-value",style:{whiteSpace:"nowrap"}},a));var f=b.cssclass,j=!b.visible();return(j||this.props.rightmost||this.props.leftmost)&&(j&&(f+=" cell-hidden"),!this.props.rightmost||b.axetype===g.Type.COLUMNS&&b.type!==h.HeaderType.GRAND_TOTAL||(f+=" cell-rightmost"),this.props.leftmost&&(f+=" cell-leftmost")),React.createElement("td",{className:f,colSpan:b.hspan()+(this.props.leftmost?i:0),rowSpan:b.vspan()},React.createElement("div",null,c))}});var k=b.exports.DragManager=function(){function a(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function b(a){return a.onDragOver?(a.onDragOver(h),!0):!1}function d(a){return a.onDragEnd?(a.onDragEnd(),!0):!1}function e(){return c(j,function(a){return a.component.state.isover?a:void 0},!0)}function f(){return c(k,function(a){return a.component.state.isover?a:void 0},!0)}var g=null,h=null,i=null,j=[],k=[],l=!1;return{init:function(a){l=!0,g=a},dragElement:function(a){var b=h;if(h=a,h!=b)if(null==a){var l=e(),m=f();if(l){var n=null!=m?m.position:null;g.moveButton(b,l.component.props.axetype,n)}i=null,c(j,function(a){d(a)}),c(k,function(a){d(a)})}else i=h.getDOMNode()},registerTarget:function(a,b,c,d){j.push({component:a,axetype:b,onDragOver:c,onDragEnd:d})},unregisterTarget:function(a){for(var b,c=0;c<j.length;c++)if(j[c].component==a){b=c;break}null!=b&&j.splice(b,1)},registerIndicator:function(a,b,c,d,e){k.push({component:a,axetype:b,position:c,onDragOver:d,onDragEnd:e})},unregisterIndicator:function(a){for(var b,c=0;c<k.length;c++)if(k[c].component==a){b=c;break}null!=b&&k.splice(b,1)},elementMoved:function(){if(null!=h){var e,f=i.getBoundingClientRect();c(j,function(c){if(!e){var g=c.component.getDOMNode().getBoundingClientRect(),h=a(f,g);if(h&&b(c))return e=c,!0;d(c)}},!0);var g;if(e){if(c(k,function(c){if(!g){var i=c.component.props.axetype===h.props.axetype&&c.component.props.position===h.props.position,j=c.component.props.axetype===e.component.props.axetype;if(j&&!i){var k=c.component.getDOMNode().getBoundingClientRect(),l=a(f,k);if(l&&b(c))return void(g=c)}}d(c)}),!g){var l=k.filter(function(a){return a.component.props.axetype===e.component.props.axetype});l.length>0&&b(l[l.length-1])}}else c(k,function(a){d(a)})}}}}(),l=0;b.exports.DropTarget=React.createClass({displayName:"DropTarget",getInitialState:function(){return this.dtid=++l,k.registerTarget(this,this.props.axetype,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){k.unregisterTarget(this)},onDragOver:function(){this.setState({isover:!0})},onDragEnd:function(){this.setState({isover:!1})},render:function(){var a=this,c=b.exports.DropIndicator,d=this.props.data.map(function(b,d){return d<a.props.data.length-1?[React.createElement(c,{isFirst:0===d,position:d,axetype:a.props.axetype}),b]:[React.createElement(c,{isFirst:0===d,position:d,axetype:a.props.axetype}),b,React.createElement(c,{isLast:!0,position:null,axetype:a.props.axetype})]});return React.createElement("div",{className:"drop-target"+(this.state.isover?" drag-over":"")},d)}}),b.exports.DropIndicator=React.createClass({displayName:"DropIndicator",getInitialState:function(){return k.registerIndicator(this,this.props.axetype,this.props.position,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){k.unregisterIndicator(this)},onDragOver:function(a){this.setState({isover:!0,width:a.getDOMNode().style.width})},onDragEnd:function(){this.setState({isover:!1,width:null})},render:function(){var a="drop-indicator";this.props.isFirst&&(a+=" drop-indicator-first"),this.props.isLast&&(a+=" drop-indicator-last");var b={};return this.state.isover&&(a+=" drop-indicator-drag-over"),React.createElement("div",{style:b,className:a})}});var m=0;b.exports.PivotButton=React.createClass({displayName:"PivotButton",getInitialState:function(){return this.pbid=++m,{pos:{x:0,y:0},startpos:{x:0,y:0},mousedown:!1,dragging:!1}},onMouseDown:function(a){if(0===a.button){var b=d(this.getDOMNode());this.setState({mousedown:!0,mouseoffset:{x:b.x-a.pageX,y:b.y-a.pageY},startpos:{x:a.pageX,y:a.pageY}}),a.stopPropagation(),a.preventDefault()}},componentDidUpdate:function(){this.state.mousedown?this.state.mousedown&&(k.dragElement(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(k.dragElement(null),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))},componentWillUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},onMouseUp:function(){var a=this.state.dragging;this.setState({mousedown:!1,dragging:!1,size:null,pos:{x:0,y:0}}),a||this.props.rootComp.sort(this.props.axetype,this.props.field)},onMouseMove:function(a){if(this.state.mousedown){var b=null;b=this.state.dragging?this.state.size:e(this.getDOMNode());var c={x:a.pageX+this.state.mouseoffset.x,y:a.pageY+this.state.mouseoffset.y};this.setState({dragging:!0,size:b,pos:c}),k.elementMoved(),a.stopPropagation(),a.preventDefault()}},render:function(){var a=this,c={left:a.state.pos.x+"px",top:a.state.pos.y+"px",position:a.state.dragging?"fixed":""};a.state.size&&(c.width=a.state.size.width+"px");var d=(b.exports.DropIndicator,"asc"===a.props.field.sort.order?" \u25b3":"desc"===a.props.field.sort.order?" \u25bd":"");return React.createElement("div",{key:a.props.field.name,className:"field-button",onMouseDown:this.onMouseDown,style:c},a.props.field.caption,React.createElement("span",null,d))}})},{"../orb.axe":2,"../orb.ui.header":8,"../orb.utils":11}]},{},[5])(5)});